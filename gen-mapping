#!/bin/env python3

from bs4 import BeautifulSoup
import requests

def get_soup(uri):
    r = requests.get(uri)
    return BeautifulSoup(r.content, 'html.parser')

def gen_mapping(filename, url):
    """"Generate a Typst mapping table for keyrune/manarune cheatsheet site."""
    with open(filename, "w") as f:
        f.write("// This file is autogenerated\n")
        f.write("#let glyphs = (\n")

        for t in get_soup(url).find_all('span', class_='utf'):
            name = t.find(string=True, recursive=False).text.strip().replace('ms-', '')
            code = int(t.find('code').text.replace('&#x', '').replace(';', ''), base=16)
            f.write("\"" + name + "\": " + str(code) + ",\n")
        f.write(")\n")

if __name__ == "__main__":
    gen_mapping("mana.mapping.typ", "https://mana.andrewgioia.com/cheatsheet.html")
    gen_mapping("keyrune.mapping.typ", "https://keyrune.andrewgioia.com/cheatsheet.html")
